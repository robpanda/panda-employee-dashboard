let employees=[];let terminatedEmployees=[];const API_BASE='https://w40mq6ab11.execute-api.us-east-2.amazonaws.com/prod';async function loadEmployees(){const container=document.querySelector('.container');if(container){container.style.opacity='0.7';container.style.pointerEvents='none'}try{const response=await fetch(`${API_BASE}/employees`);const data=await response.json();if(data.employees){let allEmployees=data.employees;employees=allEmployees.filter(emp=>emp.Terminated!=='Yes');terminatedEmployees=allEmployees.filter(emp=>emp.Terminated==='Yes');renderTerminatedTable()}}catch(error){console.error('Load failed:',error)}finally{if(container){container.style.opacity='1';container.style.pointerEvents='auto'}}}function renderTerminatedTable(){const tbody=document.getElementById('terminatedTableBody');tbody.innerHTML='';let thisMonth=0,thisYear=0,totalTenure=0;const today=new Date();const thisMonthStart=new Date(today.getFullYear(),today.getMonth(),1);const thisYearStart=new Date(today.getFullYear(),0,1);terminatedEmployees.forEach((emp,index)=>{const termDate=new Date(emp['Termination Date']);const empDate=new Date(emp['Employment Date']);if(termDate>=thisMonthStart)thisMonth++;if(termDate>=thisYearStart)thisYear++;if(empDate&&termDate){const tenure=(termDate-empDate)/(1000*60*60*24*365.25);totalTenure+=tenure}const row=document.createElement('tr');row.innerHTML=`<td>${emp['First Name']||''}</td><td>${emp['Last Name']||''}</td><td>${emp.Department||''}</td><td>${emp.Position||''}</td><td>${emp['Employment Date']||''}</td><td>${emp['Termination Date']||'N/A'}</td><td>${emp.Email||''}</td><td class="actions-col"><button class="btn" onclick="reactivateEmployee(${index})" title="Reactivate Employee">ðŸ”„</button></td>`;tbody.appendChild(row)});document.getElementById('totalTerminated').textContent=terminatedEmployees.length;document.getElementById('terminatedThisMonth').textContent=thisMonth;document.getElementById('terminatedThisYear').textContent=thisYear;document.getElementById('avgTenure').textContent=terminatedEmployees.length>0?(totalTenure/terminatedEmployees.length).toFixed(1):0}async function reactivateEmployee(index){const btn=event.target;const originalText=btn.innerHTML;btn.innerHTML='ðŸ¤”';btn.disabled=true;const employee=terminatedEmployees[index];delete employee['Termination Date'];employee['Terminated']='No';employees.push(employee);terminatedEmployees.splice(index,1);try{await saveEmployeesToDB([...employees,...terminatedEmployees]);renderTerminatedTable()}catch(error){console.error('Reactivate failed:',error)}finally{btn.innerHTML=originalText;btn.disabled=false}}async function saveEmployeesToDB(allEmployees){try{const response=await fetch(`${API_BASE}/employees`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({employees:allEmployees})});if(!response.ok)throw new Error('Save failed');return await response.json()}catch(error){console.error('Database save failed:',error);throw error}}function searchTerminated(){const term=document.getElementById('terminatedSearch').value.toLowerCase();const rows=document.querySelectorAll('#terminatedTableBody tr');rows.forEach(row=>{const text=row.textContent.toLowerCase();row.style.display=text.includes(term)?'':'none'})}document.addEventListener('DOMContentLoaded',function(){document.getElementById('terminatedSearch').addEventListener('keypress',function(e){if(e.key==='Enter')searchTerminated()});document.getElementById('terminatedSearch').addEventListener('input',searchTerminated);loadEmployees()});