<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management - Panda Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .card { border: none; border-radius: 0.75rem; }
        .sortable { cursor: pointer; user-select: none; }
        .sortable:hover { background-color: #e9ecef; }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-success shadow">
        <div class="container">
            <a class="navbar-brand" href="/"><img src="panda-logo.png" alt="Panda" style="height: 40px;"></a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link active" href="/employee.html">Employees</a>
                <a class="nav-link" href="/leads.html">Leads</a>
                <a class="nav-link" href="/referrals.html">Referrals</a>
                <a class="nav-link" href="/assets.html">Assets</a>
                <a class="nav-link" href="/admin.html">Admin</a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="display-6 fw-bold text-success mb-0">Employee Management</h1>
            <div class="d-flex gap-2">
                <div class="badge bg-success fs-6 px-3 py-2">Active: <span id="activeCount">0</span></div>
                <div class="badge bg-secondary fs-6 px-3 py-2">Total: <span id="totalCount">0</span></div>
            </div>
        </div>
        
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card shadow-sm">
                    <div class="card-body py-3">
                        <div class="row g-3 align-items-center">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text bg-light"><i class="fas fa-search"></i></span>
                                    <input type="text" class="form-control" id="searchInput" placeholder="Search employees..." onkeyup="filterEmployees()">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="officeFilter" onchange="filterEmployees()">
                                    <option value="">All Offices</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="roleFilter" onchange="filterEmployees()">
                                    <option value="">All Roles</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm">
                    <div class="card-body text-center">
                        <h5 class="card-title"><i class="fas fa-sync text-success"></i> Data Management</h5>
                        <button class="btn btn-success" onclick="importFromGoogleSheets()">
                            <i class="fas fa-download"></i> Sync Google Sheets
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <ul class="nav nav-pills nav-fill mb-4" id="employeeTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="active-employees-tab" data-bs-toggle="tab" data-bs-target="#active-employees" type="button" role="tab">
                    <i class="fas fa-users me-2"></i>Active Employees <span class="badge bg-success ms-2" id="activeTabCount">0</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="terminated-employees-tab" data-bs-toggle="tab" data-bs-target="#terminated-employees" type="button" role="tab">
                    <i class="fas fa-user-times me-2"></i>Terminated Employees <span class="badge bg-danger ms-2" id="terminatedTabCount">0</span>
                </button>
            </li>
        </ul>

        <div class="tab-content" id="employeeTabContent">
            <!-- Active Employees Tab -->
            <div class="tab-pane fade show active" id="active-employees" role="tabpanel">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-users me-2"></i>Active Employees</h5>
                        <div>
                            <button class="btn btn-outline-light btn-sm me-2" onclick="clearFilters()">Clear Filters</button>
                            <a href="/admin.html" class="btn btn-light btn-sm">Admin Console</a>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div id="importResults" class="p-3"></div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="fw-semibold sortable" onclick="sortTable('name')">Name <i class="fas fa-sort"></i></th>
                                        <th class="fw-semibold sortable" onclick="sortTable('employee_id')">Employee ID <i class="fas fa-sort"></i></th>
                                        <th class="fw-semibold sortable" onclick="sortTable('role')">Role <i class="fas fa-sort"></i></th>
                                        <th class="fw-semibold sortable" onclick="sortTable('supervisor')">Supervisor <i class="fas fa-sort"></i></th>
                                        <th class="fw-semibold sortable" onclick="sortTable('office')">Office <i class="fas fa-sort"></i></th>
                                        <th class="fw-semibold sortable" onclick="sortTable('department')">Department <i class="fas fa-sort"></i></th>
                                        <th class="fw-semibold sortable" onclick="sortTable('hire_date')">Hire Date <i class="fas fa-sort"></i></th>
                                        <th class="fw-semibold">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="activeEmployeesTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Terminated Employees Tab -->
            <div class="tab-pane fade" id="terminated-employees" role="tabpanel">
                <div class="card shadow-sm">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0"><i class="fas fa-user-times me-2"></i>Terminated Employees</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="fw-semibold sortable" onclick="sortTable('name')">Name <i class="fas fa-sort"></i></th>
                                        <th class="fw-semibold sortable" onclick="sortTable('employee_id')">Employee ID <i class="fas fa-sort"></i></th>
                                        <th class="fw-semibold sortable" onclick="sortTable('role')">Role <i class="fas fa-sort"></i></th>
                                        <th class="fw-semibold sortable" onclick="sortTable('office')">Office <i class="fas fa-sort"></i></th>
                                        <th class="fw-semibold sortable" onclick="sortTable('hire_date')">Hire Date <i class="fas fa-sort"></i></th>
                                        <th class="fw-semibold">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="terminatedEmployeesTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_URL = 'https://4ytrdf6rpklojh5c52gxpf5iei0winqx.lambda-url.us-east-2.on.aws';
        let employees = [];
        let filteredEmployees = [];
        let sortColumn = '';
        let sortDirection = 'asc';

        // Static employee data from Google Sheets
        const staticEmployees = [
            {"employee_id":"10427","last_name":"Abel","first_name":"Bryan","name":"Bryan Abel","email":"bryan.abel@pandaexteriors.com","role":"Director of Finance","department":"Finance & Accounting","office":"Maryland Office","supervisor":"Daniel, Jason","hire_date":"11/13/2023","status":"active","points_balance":125,"points_lifetime":250,"phone":"(555) 123-4567"},
            {"employee_id":"11254","last_name":"Aggelis","first_name":"George","name":"George Aggelis","email":"george.aggelis@pandaexteriors.com","role":"Sales Representative","department":"Insurance Sales","office":"Maryland Office","supervisor":"Konstandinidis, Joshua","hire_date":"08/28/2025","status":"active","points_balance":0,"points_lifetime":0,"phone":"(555) 234-5678"},
            {"employee_id":"10702","last_name":"Andrade","first_name":"Bryan","name":"Bryan Andrade","email":"bryan.andrade@pandaexteriors.com","role":"Call Center Sales Representative","department":"Call Center","office":"Maryland Office","supervisor":"Gasper, Sutton","hire_date":"07/30/2024","status":"active","points_balance":75,"points_lifetime":150,"phone":"(555) 345-6789"},
            {"employee_id":"10955","last_name":"Arango","first_name":"Camila","name":"Camila Arango","email":"camila.arango@pandaexteriors.com","role":"Junior Recruiter","department":"Talent Acquisition","office":"Maryland Office","supervisor":"Gessler, Nicholas","hire_date":"02/24/2025","status":"active","points_balance":50,"points_lifetime":100,"phone":"(555) 456-7890"},
            {"employee_id":"10311","last_name":"Arpan","first_name":"J.","name":"J. Arpan","email":"j.arpan@pandaexteriors.com","role":"Director of Sales - Insurance Division","department":"Insurance Sales","office":"Maryland Office","supervisor":"Tucker, Christopher","hire_date":"06/12/2023","status":"active","points_balance":200,"points_lifetime":400,"phone":"(555) 567-8901"},
            {"employee_id":"10221","last_name":"Atias","first_name":"Dan","name":"Dan Atias","email":"dan.atias@pandaexteriors.com","role":"Sales Representative","department":"Insurance Sales","office":"Maryland Office","supervisor":"Konstandinidis, Joshua","hire_date":"10/01/2021","status":"active","points_balance":300,"points_lifetime":600,"phone":"(555) 678-9012"},
            {"employee_id":"10679","last_name":"Atkinson","first_name":"Chris","name":"Chris Atkinson","email":"chris.atkinson@pandaexteriors.com","role":"Sales Representative","department":"Insurance Sales","office":"Maryland Office","supervisor":"Konstandinidis, Joshua","hire_date":"07/08/2024","status":"active","points_balance":100,"points_lifetime":200,"phone":"(555) 789-0123"},
            {"employee_id":"11128","last_name":"Auletto","first_name":"Spencer","name":"Spencer Auletto","email":"spencer.auletto@pandaexteriors.com","role":"Roofing Project Manager","department":"Operations","office":"New Jersey Office","supervisor":"Johnson, Trevor","hire_date":"07/07/2025","status":"active","points_balance":25,"points_lifetime":50,"phone":"(555) 890-1234"},
            {"employee_id":"10240","last_name":"Ayala Lovo","first_name":"Christopher","name":"Christopher Ayala Lovo","email":"christopher.ayalalovo@pandaexteriors.com","role":"Project Manager","department":"Operations","office":"Maryland Office","supervisor":"Johnson, Trevor","hire_date":"03/06/2023","status":"active","points_balance":175,"points_lifetime":350,"phone":"(555) 901-2345"},
            {"employee_id":"10452","last_name":"Ayers","first_name":"Brian","name":"Brian Ayers","email":"brian.ayers@pandaexteriors.com","role":"DE Sales Manager - Insurance Division","department":"Insurance Sales","office":"Delaware Office","supervisor":"Arpan, Justin","hire_date":"01/03/2024","status":"active","points_balance":150,"points_lifetime":300,"phone":"(555) 012-3456"},
            {"employee_id":"10008","last_name":"Curry","first_name":"Christian","name":"Christian Curry","email":"christian.curry@pandaexteriors.com","role":"President","department":"Business Operations","office":"Maryland Office","supervisor":"Tucker, Christopher","hire_date":"09/24/2021","status":"active","points_balance":500,"points_lifetime":1000,"phone":"(555) 123-4567"},
            {"employee_id":"10112","last_name":"Daniel","first_name":"Jason","name":"Jason Daniel","email":"jason.daniel@pandaexteriors.com","role":"Chief Financial Officer","department":"Finance & Accounting","office":"Maryland Office","supervisor":"","hire_date":"12/01/2020","status":"active","points_balance":400,"points_lifetime":800,"phone":"(555) 234-5678"},
            {"employee_id":"10140","last_name":"Kilbourne","first_name":"Cheyne","name":"Cheyne Kilbourne","email":"cheyne.kilbourne@pandaexteriors.com","role":"Chief Operations Officer","department":"Business Operations","office":"Maryland Office","supervisor":"","hire_date":"01/01/2021","status":"active","points_balance":450,"points_lifetime":900,"phone":"(555) 345-6789"},
            {"employee_id":"10110","last_name":"Tucker","first_name":"Scott","name":"Scott Tucker","email":"scott.tucker@pandaexteriors.com","role":"Chief Executive Officer","department":"Business Operations","office":"Maryland Office","supervisor":"","hire_date":"12/01/2020","status":"active","points_balance":500,"points_lifetime":1000,"phone":"(555) 456-7890"},
            {"employee_id":"10980","last_name":"Winters","first_name":"Rob","name":"Rob Winters","email":"rob.winters@pandaexteriors.com","role":"Digital Marketing Director","department":"Business Operations","office":"Maryland Office","supervisor":"Curry, Christian","hire_date":"03/03/2025","status":"active","points_balance":500,"points_lifetime":500,"phone":"(555) 567-8901"},
            {"employee_id":"10026","last_name":"Johnson","first_name":"Trevor","name":"Trevor Johnson","email":"trevor.johnson@pandaexteriors.com","role":"Director of Operations","department":"Operations","office":"Maryland Office","supervisor":"Hallwig, Thomas","hire_date":"06/13/2022","status":"active","points_balance":350,"points_lifetime":700,"phone":"(555) 678-9012"},
            {"employee_id":"10037","last_name":"Liebno","first_name":"Valerie","name":"Valerie Liebno","email":"valerie.liebno@pandaexteriors.com","role":"Director of Human Resources","department":"Human Resources","office":"Maryland Office","supervisor":"Daniel, Jason","hire_date":"12/05/2022","status":"active","points_balance":275,"points_lifetime":550,"phone":"(555) 789-0123"},
            {"employee_id":"10412","last_name":"LaRose Jr","first_name":"Joe","name":"Joe LaRose Jr","email":"joe.larosejr@pandaexteriors.com","role":"Director of Sales - Retail Division","department":"Retail/Solar Sales","office":"New Jersey Office","supervisor":"Curry, Christian","hire_date":"10/30/2023","status":"active","points_balance":225,"points_lifetime":450,"phone":"(555) 890-1234"},
            {"employee_id":"10414","last_name":"Gasper","first_name":"Sutton","name":"Sutton Gasper","email":"sutton.gasper@pandaexteriors.com","role":"Service Center Manager","department":"Call Center","office":"Maryland Office","supervisor":"Sandberg, Todd","hire_date":"10/30/2023","status":"active","points_balance":200,"points_lifetime":400,"phone":"(555) 901-2345"},
            {"employee_id":"10423","last_name":"Georgiou","first_name":"Andreas","name":"Andreas Georgiou","email":"andreas.georgiou@pandaexteriors.com","role":"Asset Manager","department":"Assets","office":"Maryland Office","supervisor":"Daniel, Jason","hire_date":"11/08/2023","status":"active","points_balance":175,"points_lifetime":350,"phone":"(555) 012-3456"},
            {"employee_id":"10915","last_name":"Gessler","first_name":"Nicholas","name":"Nicholas Gessler","email":"nicholas.gessler@pandaexteriors.com","role":"Director of Talent Acquisition","department":"Talent Acquisition","office":"Maryland Office","supervisor":"Liebno, Valerie","hire_date":"02/03/2025","status":"active","points_balance":100,"points_lifetime":200,"phone":"(555) 123-4567"},
            {"employee_id":"10981","last_name":"McGinnis","first_name":"David","name":"David McGinnis","email":"david.mcginnis@pandaexteriors.com","role":"Director of Retail Business Development","department":"Retail Business Development","office":"New Jersey Office","supervisor":"Curry, Christian","hire_date":"03/04/2025","status":"active","points_balance":125,"points_lifetime":250,"phone":"(555) 234-5678"},
            {"employee_id":"10923","last_name":"Sandberg","first_name":"Todd","name":"Todd Sandberg","email":"todd.sandberg@pandaexteriors.com","role":"Director of Business Operations","department":"Business Operations","office":"Maryland Office","supervisor":"Curry, Christian","hire_date":"02/10/2025","status":"active","points_balance":150,"points_lifetime":300,"phone":"(555) 345-6789"},
            {"employee_id":"10022","last_name":"Wooten","first_name":"Jason","name":"Jason Wooten","email":"jason.wooten@pandaexteriors.com","role":"Director of Sales Operations","department":"Estimating","office":"Maryland Office","supervisor":"Tucker, Christopher","hire_date":"04/27/2022","status":"active","points_balance":275,"points_lifetime":550,"phone":"(555) 456-7890"},
            {"employee_id":"10014","last_name":"Hallwig","first_name":"Thomas","name":"Thomas Hallwig","email":"thomas.hallwig@pandaexteriors.com","role":"Director of Operations - Commercial Division","department":"Commercial","office":"Maryland Office","supervisor":"Tucker, Christopher","hire_date":"01/17/2022","status":"active","points_balance":300,"points_lifetime":600,"phone":"(555) 567-8901"}
        ];

        document.addEventListener('DOMContentLoaded', function() {
            // Use static data for presentation
            employees = staticEmployees;
            filteredEmployees = [...employees];
            displayEmployees();
            populateFilters();
        });

        async function loadEmployees() {
            try {
                const response = await fetch(`${API_URL}/employees`);
                employees = await response.json();
                filteredEmployees = [...employees];
                displayEmployees();
                populateFilters();
            } catch (error) {
                console.error('Error loading employees:', error);
                document.getElementById('importResults').innerHTML = 
                    '<div class="alert alert-danger">Failed to load employees. Please check API connection.</div>';
            }
        }

        async function importFromGoogleSheets() {
            try {
                document.getElementById('importResults').innerHTML = 
                    '<div class="alert alert-info">Importing from Google Sheets...</div>';
                
                const response = await fetch(`${API_URL}/import`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('importResults').innerHTML = 
                        `<div class="alert alert-success">${result.message}</div>`;
                    await loadEmployees();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                document.getElementById('importResults').innerHTML = 
                    `<div class="alert alert-danger">Import failed: ${error.message}</div>`;
            }
        }

        function displayEmployees() {
            const activeTableBody = document.getElementById('activeEmployeesTableBody');
            const terminatedTableBody = document.getElementById('terminatedEmployeesTableBody');
            
            activeTableBody.innerHTML = '';
            terminatedTableBody.innerHTML = '';
            
            let activeCount = 0;
            let terminatedCount = 0;
            
            filteredEmployees.forEach(employee => {
                const row = createEmployeeRow(employee);
                
                if (employee.status === 'active') {
                    activeTableBody.appendChild(row);
                    activeCount++;
                } else {
                    terminatedTableBody.appendChild(row);
                    terminatedCount++;
                }
            });
            
            document.getElementById('activeCount').textContent = activeCount;
            document.getElementById('activeTabCount').textContent = activeCount;
            document.getElementById('terminatedTabCount').textContent = terminatedCount;
            document.getElementById('totalCount').textContent = activeCount + terminatedCount;
        }

        function createEmployeeRow(employee) {
            const row = document.createElement('tr');
            
            if (employee.status === 'active') {
                row.innerHTML = `
                    <td><strong>${employee.name || ''}</strong><br><small class="text-muted">${employee.email || ''}</small></td>
                    <td>${employee.employee_id || ''}</td>
                    <td>${employee.role || ''}</td>
                    <td>${employee.supervisor || ''}</td>
                    <td>${employee.office || ''}</td>
                    <td>${employee.department || ''}</td>
                    <td>${employee.hire_date || ''}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewEmployee('${employee.email}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
            } else {
                row.innerHTML = `
                    <td><strong>${employee.name || ''}</strong><br><small class="text-muted">${employee.email || ''}</small></td>
                    <td>${employee.employee_id || ''}</td>
                    <td>${employee.role || ''}</td>
                    <td>${employee.office || ''}</td>
                    <td>${employee.hire_date || ''}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewEmployee('${employee.email}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
            }
            
            return row;
        }

        function populateFilters() {
            const offices = [...new Set(employees.map(e => e.office).filter(Boolean))];
            const roles = [...new Set(employees.map(e => e.role).filter(Boolean))];
            
            populateSelect('officeFilter', offices);
            populateSelect('roleFilter', roles);
        }

        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            const allOption = select.querySelector('option[value=""]');
            select.innerHTML = '';
            select.appendChild(allOption);
            
            options.sort().forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
        }

        function filterEmployees() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const officeFilter = document.getElementById('officeFilter').value;
            const roleFilter = document.getElementById('roleFilter').value;
            
            filteredEmployees = employees.filter(employee => {
                const matchesSearch = !searchTerm || 
                    (employee.name && employee.name.toLowerCase().includes(searchTerm)) ||
                    (employee.email && employee.email.toLowerCase().includes(searchTerm)) ||
                    (employee.employee_id && employee.employee_id.toLowerCase().includes(searchTerm));
                
                const matchesOffice = !officeFilter || employee.office === officeFilter;
                const matchesRole = !roleFilter || employee.role === roleFilter;
                
                return matchesSearch && matchesOffice && matchesRole;
            });
            
            displayEmployees();
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('officeFilter').value = '';
            document.getElementById('roleFilter').value = '';
            filteredEmployees = [...employees];
            displayEmployees();
        }

        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }
            
            filteredEmployees.sort((a, b) => {
                let aVal = a[column] || '';
                let bVal = b[column] || '';
                
                if (sortDirection === 'asc') {
                    return aVal.localeCompare(bVal);
                } else {
                    return bVal.localeCompare(aVal);
                }
            });
            
            displayEmployees();
        }

        function viewEmployee(email) {
            const employee = employees.find(e => e.email === email);
            if (employee) {
                alert(`Employee Details:\n\nName: ${employee.name}\nEmployee ID: ${employee.employee_id}\nRole: ${employee.role}\nSupervisor: ${employee.supervisor}\nOffice: ${employee.office}\nDepartment: ${employee.department}\nHire Date: ${employee.hire_date}\nPhone: ${employee.phone}\nEmail: ${employee.email}\nStatus: ${employee.status}`);
            }
        }
    </script>
</body>
</html>