<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin Dashboard - Panda Referrals</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
        }
        .navbar {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 16px 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .navbar-brand {
            color: white !important;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .navbar-brand img {
            height: 32px;
            background: white;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .navbar-brand .admin-badge {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .user-info {
            color: rgba(255,255,255,0.9);
            font-size: 14px;
        }
        .user-info .name {
            font-weight: 500;
        }
        .user-info .role {
            font-size: 12px;
            opacity: 0.7;
            color: #fca5a5;
        }
        .main-container {
            max-width: 1600px;
            margin: 24px auto;
            padding: 0 24px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #3b82f6;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .stat-card.primary { border-left-color: #3b82f6; }
        .stat-card.success { border-left-color: #10b981; }
        .stat-card.warning { border-left-color: #f59e0b; }
        .stat-card.danger { border-left-color: #ef4444; }
        .stat-card.purple { border-left-color: #8b5cf6; }
        .stat-card .label {
            font-size: 13px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
            color: #111827;
            line-height: 1;
        }
        .stat-card .subtext {
            font-size: 13px;
            color: #9ca3af;
            margin-top: 8px;
        }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
            border: none;
        }
        .card-header {
            padding: 20px 24px;
            border-bottom: 2px solid #e5e7eb;
            background: linear-gradient(to bottom, #ffffff, #f9fafb);
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .card-header h2 {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card-header .badge {
            font-size: 11px;
            padding: 4px 10px;
        }
        .card-body {
            padding: 24px;
        }
        .table {
            margin-bottom: 0;
        }
        .table th {
            background: #f9fafb;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            padding: 14px 12px;
        }
        .table td {
            padding: 16px 12px;
            vertical-align: middle;
            border-bottom: 1px solid #f3f4f6;
            font-size: 14px;
        }
        .badge {
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .badge-info { background: #dbeafe; color: #1e40af; }
        .badge-purple { background: #ede9fe; color: #5b21b6; }
        .btn-logout {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
        }
        .btn-logout:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        .btn-payout {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-payout:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
            color: white;
        }
        .btn-payout:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }
        .btn-reject {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
        }
        .btn-reject:hover {
            background: #fecaca;
            color: #7f1d1d;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }
        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        .nav-tabs {
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 20px;
        }
        .nav-tabs .nav-link {
            color: #6b7280;
            border: none;
            padding: 12px 24px;
            font-weight: 500;
            border-bottom: 3px solid transparent;
        }
        .nav-tabs .nav-link.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: none;
        }
        .payout-amount {
            font-size: 18px;
            font-weight: 700;
            color: #10b981;
        }
        /* Mobile responsive */
        @media (max-width: 768px) {
            .table thead { display: none; }
            .table, .table tbody, .table tr, .table td {
                display: block;
                width: 100%;
            }
            .table tr {
                margin-bottom: 16px;
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                padding: 12px;
                background: white;
            }
            .table td {
                border: none;
                padding: 8px 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .table td:before {
                content: attr(data-label);
                font-weight: 600;
                color: #6b7280;
                font-size: 12px;
                text-transform: uppercase;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="d-flex align-items-center justify-content-between w-100">
            <a class="navbar-brand" href="#">
                <img src="http://pandaadmin.com.s3-website-us-east-1.amazonaws.com/panda-logo.png" alt="Panda">
                Super Admin Dashboard
                <span class="admin-badge">Admin</span>
            </a>
            <div class="d-flex align-items-center gap-3">
                <div class="user-info">
                    <div class="name" id="adminName">Loading...</div>
                    <div class="role">Super Administrator</div>
                </div>
                <button class="btn btn-logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card primary">
                <div class="label">Total Sales Managers</div>
                <div class="value" id="totalManagers">0</div>
                <div class="subtext">Active managers</div>
            </div>
            <div class="stat-card success">
                <div class="label">Total Sales Reps</div>
                <div class="value" id="totalReps">0</div>
                <div class="subtext">Active representatives</div>
            </div>
            <div class="stat-card warning">
                <div class="label">Total Advocates</div>
                <div class="value" id="totalAdvocates">0</div>
                <div class="subtext">Enrolled advocates</div>
            </div>
            <div class="stat-card purple">
                <div class="label">Total Referrals</div>
                <div class="value" id="totalReferrals">0</div>
                <div class="subtext">All time referrals</div>
            </div>
            <div class="stat-card danger">
                <div class="label">Pending Payouts</div>
                <div class="value">$<span id="pendingPayoutsAmount">0</span></div>
                <div class="subtext"><span id="pendingPayoutsCount">0</span> payouts waiting</div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#payouts">
                    <i class="fas fa-money-check-alt"></i> Payouts
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#managers">
                    <i class="fas fa-users-cog"></i> Sales Managers
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#reps">
                    <i class="fas fa-users"></i> Sales Reps
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#referrals">
                    <i class="fas fa-handshake"></i> All Referrals
                </a>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Payouts Tab -->
            <div class="tab-pane fade show active" id="payouts">
                <div class="card">
                    <div class="card-header">
                        <h2>
                            <i class="fas fa-money-check-alt"></i> Payout Management
                            <span class="badge badge-warning" id="pendingBadge">0 Pending</span>
                        </h2>
                        <button class="btn btn-sm btn-outline-primary" onclick="loadPayouts()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Advocate</th>
                                        <th>Email</th>
                                        <th>Amount</th>
                                        <th>Referrals</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="payoutsTableBody">
                                    <tr>
                                        <td colspan="7" class="empty-state">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            <p>Loading payouts...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Managers Tab -->
            <div class="tab-pane fade" id="managers">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-users-cog"></i> Sales Managers</h2>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Team Size</th>
                                        <th>Total Advocates</th>
                                        <th>Total Referrals</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="managersTableBody">
                                    <tr>
                                        <td colspan="6" class="empty-state">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            <p>Loading managers...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reps Tab -->
            <div class="tab-pane fade" id="reps">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-users"></i> All Sales Representatives</h2>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Manager</th>
                                        <th>Advocates</th>
                                        <th>Referrals</th>
                                        <th>Conversion</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="repsTableBody">
                                    <tr>
                                        <td colspan="7" class="empty-state">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            <p>Loading reps...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Referrals Tab -->
            <div class="tab-pane fade" id="referrals">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-handshake"></i> All Referrals</h2>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Lead Name</th>
                                        <th>Phone</th>
                                        <th>Product</th>
                                        <th>Advocate</th>
                                        <th>Sales Rep</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody id="referralsTableBody">
                                    <tr>
                                        <td colspan="7" class="empty-state">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            <p>Loading referrals...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        const API_BASE = 'https://7paaginnvg.execute-api.us-east-2.amazonaws.com/prod/referrals';
        let adminData = null;
        let allReps = [];
        let allAdvocates = [];
        let allLeads = [];
        let allPayouts = [];
        let stripe = null;

        // Check auth on load
        window.addEventListener('load', async function() {
            const token = localStorage.getItem('repToken');
            const data = localStorage.getItem('repData');

            if (!token || !data) {
                window.location.href = 'rep-login.html';
                return;
            }

            try {
                adminData = JSON.parse(data);

                // Check if user is super admin
                if (adminData.role !== 'superadmin') {
                    alert('Access denied. This page is for super administrators only.');
                    if (adminData.role === 'manager') {
                        window.location.href = 'manager-dashboard.html';
                    } else {
                        window.location.href = 'rep-dashboard.html';
                    }
                    return;
                }

                updateUI();
                await loadAllData();
            } catch (error) {
                console.error('Error loading admin data:', error);
                window.location.href = 'rep-login.html';
            }
        });

        function updateUI() {
            const name = `${adminData.firstName || ''} ${adminData.lastName || ''}`.trim();
            document.getElementById('adminName').textContent = name || 'Admin';
        }

        async function loadAllData() {
            try {
                // Load all data in parallel
                const [repsRes, advocatesRes, leadsRes, payoutsRes] = await Promise.all([
                    fetch(`${API_BASE}/reps`),
                    fetch(`${API_BASE}/advocates`),
                    fetch(`${API_BASE}/leads`),
                    fetch(`${API_BASE}/payouts`)
                ]);

                const [repsData, advocatesData, leadsData, payoutsData] = await Promise.all([
                    repsRes.json(),
                    advocatesRes.json(),
                    leadsRes.json(),
                    payoutsRes.json()
                ]);

                allReps = repsData.reps || [];
                allAdvocates = advocatesData.advocates || [];
                allLeads = leadsData.leads || [];
                allPayouts = payoutsData.payouts || [];

                updateStats();
                renderManagersTable();
                renderRepsTable();
                renderReferralsTable();
                renderPayoutsTable();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function updateStats() {
            const managers = allReps.filter(r => r.role === 'manager');
            const reps = allReps.filter(r => r.role === 'rep' || !r.role);
            const pendingPayouts = allPayouts.filter(p => p.status === 'pending');
            const pendingAmount = pendingPayouts.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);

            document.getElementById('totalManagers').textContent = managers.length;
            document.getElementById('totalReps').textContent = reps.length;
            document.getElementById('totalAdvocates').textContent = allAdvocates.length;
            document.getElementById('totalReferrals').textContent = allLeads.length;
            document.getElementById('pendingPayoutsAmount').textContent = pendingAmount.toFixed(2);
            document.getElementById('pendingPayoutsCount').textContent = pendingPayouts.length;
            document.getElementById('pendingBadge').textContent = `${pendingPayouts.length} Pending`;
        }

        function renderManagersTable() {
            const tbody = document.getElementById('managersTableBody');
            const managers = allReps.filter(r => r.role === 'manager');

            if (!managers.length) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-users-cog"></i>
                            <p>No managers found</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = managers.map(manager => {
                const managerName = `${manager.firstName} ${manager.lastName}`;
                const teamReps = allReps.filter(r => r.salesManager === managerName);
                const teamAdvocates = allAdvocates.filter(a => teamReps.some(r => r.repId === a.repId));
                const teamLeads = allLeads.filter(l => teamReps.some(r => r.repId === l.repId));

                return `
                    <tr>
                        <td data-label="Name">${managerName}</td>
                        <td data-label="Email">${manager.email}</td>
                        <td data-label="Team Size">${teamReps.length}</td>
                        <td data-label="Advocates">${teamAdvocates.length}</td>
                        <td data-label="Referrals">${teamLeads.length}</td>
                        <td data-label="Status"><span class="badge badge-success">Active</span></td>
                    </tr>
                `;
            }).join('');
        }

        function renderRepsTable() {
            const tbody = document.getElementById('repsTableBody');
            const reps = allReps.filter(r => r.role === 'rep' || !r.role);

            if (!reps.length) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-users"></i>
                            <p>No sales reps found</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = reps.map(rep => {
                const repAdvocates = allAdvocates.filter(a => a.repId === rep.repId);
                const repLeads = allLeads.filter(l => l.repId === rep.repId);
                const qualified = repLeads.filter(l => l.status === 'qualified' || l.status === 'sold').length;
                const conversionRate = repLeads.length > 0 ? ((qualified / repLeads.length) * 100).toFixed(0) : 0;

                return `
                    <tr>
                        <td data-label="Name">${rep.firstName} ${rep.lastName}</td>
                        <td data-label="Email">${rep.email}</td>
                        <td data-label="Manager">${rep.salesManager || 'N/A'}</td>
                        <td data-label="Advocates">${repAdvocates.length}</td>
                        <td data-label="Referrals">${repLeads.length}</td>
                        <td data-label="Conversion">${conversionRate}%</td>
                        <td data-label="Status"><span class="badge badge-success">Active</span></td>
                    </tr>
                `;
            }).join('');
        }

        function renderReferralsTable() {
            const tbody = document.getElementById('referralsTableBody');
            const recentLeads = allLeads.slice(0, 50); // Show most recent 50

            if (!recentLeads.length) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <p>No referrals yet</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = recentLeads.map(lead => {
                const advocate = allAdvocates.find(a => a.advocateId === lead.advocateId);
                const rep = allReps.find(r => r.repId === lead.repId);
                const leadName = `${lead.firstName || ''} ${lead.lastName || ''}`.trim();
                const advocateName = advocate ? `${advocate.firstName} ${advocate.lastName}` : 'N/A';
                const repName = rep ? `${rep.firstName} ${rep.lastName}` : 'N/A';
                const date = new Date(lead.createdAt).toLocaleDateString();

                let statusBadge = 'badge-info';
                if (lead.status === 'qualified') statusBadge = 'badge-success';
                if (lead.status === 'sold') statusBadge = 'badge-success';
                if (lead.status === 'lost') statusBadge = 'badge-danger';

                return `
                    <tr>
                        <td data-label="Name">${leadName}</td>
                        <td data-label="Phone">${lead.phone || 'N/A'}</td>
                        <td data-label="Product">${lead.product || 'Roofing'}</td>
                        <td data-label="Advocate">${advocateName}</td>
                        <td data-label="Rep">${repName}</td>
                        <td data-label="Status"><span class="badge ${statusBadge}">${lead.status || 'new'}</span></td>
                        <td data-label="Date">${date}</td>
                    </tr>
                `;
            }).join('');
        }

        async function loadPayouts() {
            try {
                const response = await fetch(`${API_BASE}/payouts`);
                const data = await response.json();
                allPayouts = data.payouts || [];
                renderPayoutsTable();
                updateStats();
            } catch (error) {
                console.error('Error loading payouts:', error);
            }
        }

        function renderPayoutsTable() {
            const tbody = document.getElementById('payoutsTableBody');
            const pendingPayouts = allPayouts.filter(p => p.status === 'pending');

            if (!pendingPayouts.length) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-check-circle"></i>
                            <p>No pending payouts</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = pendingPayouts.map(payout => {
                const advocate = allAdvocates.find(a => a.advocateId === payout.advocateId);
                const advocateName = advocate ? `${advocate.firstName} ${advocate.lastName}` : 'Unknown';
                const advocateEmail = advocate?.email || 'N/A';
                const date = new Date(payout.createdAt).toLocaleDateString();
                const amount = parseFloat(payout.amount) || 0;

                return `
                    <tr>
                        <td data-label="Advocate">${advocateName}</td>
                        <td data-label="Email">${advocateEmail}</td>
                        <td data-label="Amount"><span class="payout-amount">$${amount.toFixed(2)}</span></td>
                        <td data-label="Referrals">${payout.referralIds?.length || 0}</td>
                        <td data-label="Status"><span class="badge badge-warning">${payout.status}</span></td>
                        <td data-label="Created">${date}</td>
                        <td data-label="Actions">
                            <button class="btn btn-sm btn-payout me-2" onclick="processStripePayment('${payout.payoutId}', '${advocateEmail}', ${amount})">
                                <i class="fas fa-credit-card"></i> Pay via Stripe
                            </button>
                            <button class="btn btn-sm btn-reject" onclick="rejectPayout('${payout.payoutId}')">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function processStripePayment(payoutId, email, amount) {
            if (!confirm(`Process $${amount.toFixed(2)} payment to ${email} via Stripe?`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/payouts/${payoutId}/process-stripe`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('repToken')}`
                    },
                    body: JSON.stringify({
                        email: email,
                        amount: amount
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`Payment of $${amount.toFixed(2)} processed successfully via Stripe!`);
                    await loadPayouts();
                } else {
                    alert(`Error: ${data.error || 'Payment failed'}`);
                }
            } catch (error) {
                console.error('Error processing payment:', error);
                alert('Error processing payment. Please try again.');
            }
        }

        async function rejectPayout(payoutId) {
            if (!confirm('Are you sure you want to reject this payout?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/payouts/${payoutId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'rejected'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert('Payout rejected');
                    await loadPayouts();
                } else {
                    alert('Error rejecting payout');
                }
            } catch (error) {
                console.error('Error rejecting payout:', error);
                alert('Error rejecting payout. Please try again.');
            }
        }

        function logout() {
            localStorage.removeItem('repToken');
            localStorage.removeItem('repData');
            window.location.href = 'rep-login.html';
        }
    </script>
</body>
</html>
